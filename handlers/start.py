from aiogram import Router
from aiogram.filters import CommandStart
from aiogram.types import Message

from database.queries import add_user
from logger import logger

start_r = Router()


@start_r.message(CommandStart())
async def start(message: Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –±–æ—Ç–∞ –≤ —á–∞—Ç–µ."""
    await message.answer(
        "–ü—Ä–∏–≤–µ—Ç-–ø—Ä–∏–≤–µ—Ç, —è –ë–æ—Ç –ë—É–ª–æ—á–∫–∞ –î–Ω—è! ü•êü§ñ\n\n"
        "–Ø –∑–¥–µ—Å—å –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫ ‚Äì –º–æ—è –º–∏—Å—Å–∏—è –∫—Ä–∞–π–Ω–µ –≤–∞–∂–Ω–∞! –Ø –≤—Å—Ç—Ä–µ—á–∞—é –Ω–æ–≤—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å —Ç–µ–ø–ª–æ–º, –∫–∞–∫ —Å–≤–µ–∂—É—é –≤—ã–ø–µ—á–∫—É –∏–∑ –ø–µ—á–∏, "
        "–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –æ–±—ä—è–≤–ª—è—é, –∫—Ç–æ —É –Ω–∞—Å —Å–∞–º–∞—è —Å–ª–∞–¥–∫–∞—è, —Ä—É–º—è–Ω–∞—è –∏ –∞–ø–ø–µ—Ç–∏—Ç–Ω–∞—è –±—É–ª–æ—á–∫–∞! üç∞üî•\n\n"
        "–¢–∞–∫ —á—Ç–æ –≥–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ –ø–æ—Ç–æ–∫—É –º—É–∫–∏‚Ä¶ –æ–π, –≤ —Å–º—ã—Å–ª–µ ‚Äì –ª—é–±–≤–∏ –∏ –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç–æ–≤! üíñ\n\n"
        "<i>–ü—Ä–æ–µ–∫—Ç –±—É–¥–µ—Ç —Ä–∞–∑–≤–∏–≤–∞—Ç—å—Å—è –ø–æ –º–µ—Ä–µ —Ç–æ–≥–æ, –∫–∞–∫ –µ–≥–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å –ø—Ä–æ–∫–∞—á–∏–≤–∞–µ—Ç —Å–≤–æ–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç (–∞ –ø–æ–∫–∞ –æ–Ω –µ—Å—Ç –±—É–ª–æ—á–∫–∏ –∏ –ø–∏—à–µ—Ç –∫–æ–¥). üßêüç©</i>",
        parse_mode="HTML",
    )
    from_user = message.from_user
    chat_id = message.chat.id

    if message.chat.type == "private":
        await message.reply("–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –≥—Ä—É–ø–ø–æ–≤—ã—Ö —á–∞—Ç–∞—Ö!")
        return

    if not from_user:
        await message.reply("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ.")
        return

    # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑—É, –µ—Å–ª–∏ –µ–≥–æ —Ç–∞–º –Ω–µ—Ç
    user = await add_user(
        telegram_id=from_user.id,
        username=from_user.username,
        full_name=from_user.full_name,
        chat_id=chat_id,
    )
    if user:
        await message.reply(
            f"–ë–æ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –≤ —ç—Ç–æ–º —á–∞—Ç–µ! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /play, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É."
        )
        logger.info(f"–ë–æ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –≤ —á–∞—Ç–µ {chat_id} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º {from_user.id}")
    else:
        await message.reply("–í—ã —É–∂–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∏ –±–æ—Ç–∞ –≤ —ç—Ç–æ–º —á–∞—Ç–µ!")
